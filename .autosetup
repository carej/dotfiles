#!/bin/bash -eu

#===============================================================================
# Automated home directory setup script
# -------------------------------------
#
# To automate the setup of your home directory you can run this script via:
#
#   curl http://sensus-stash.davis.sensus.lab:7990/users/carej/repos/homedir/browse/.autosetup?raw | bash
#
# Yes, the "curl pipe" method is scary to some. If it's scary to you then just
# download the file first then execute it locally.
#===============================================================================

REPO=http://carej@sensus-stash.davis.sensus.lab:7990/scm/~carej/homedir.git

[[ -d ${HOME}/sandbox ]] || {

  echo "Making ${HOME}/sandbox"
  mkdir ${HOME}/sandbox
}

[[ -d ${HOME}/sandbox/homedir ]] || {

  echo "Cloning ${REPO}"
  cd ${HOME}/sandbox
  git clone --no-checkout ${REPO}
  cd homedir
  git config core.worktree ${HOME}
}

[[ -f ${HOME}/.git ]] || {

  echo "Creating ${HOME}/.git"
  echo "gitdir: ${HOME}/sandbox/homedir/.git" > ${HOME}/.git
}

cd ${HOME}
git fetch origin
git reset --hard origin/master

