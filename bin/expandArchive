#!/bin/bash -eu

RECURSIVE=false

# $1 - the file to expand
# $2 - the expansion destination
#
function inflate {

  echo "inflating ${1}"

  case ${1} in

    *.zip|*.jar|*.war|*.ear)
      unzip -qq ${1} -d ${2}
      ;;

    *.tar|*.tgz|*.tar.gz)
      tar -C ${2} xf ${1}
      ;;
  esac

  if [[ ${RECURSIVE} == true ]]; then

    for FILE in $(find ${2} -type f \( -name '*.zip' -o -name '*.jar' \)); do

      inflate ${FILE} $(dirname ${FILE})/expanded-$(basename ${FILE})
    done
  fi
}

until [[ ${#} -eq 0 ]]; do
  case ${1} in

    -R|--recursive)
      RECURSIVE=true
      shift
      ;;

    *)
      break
      ;;
  esac
done

for FILE in "${@}"; do

  # skip things that are not files
  #
  [[ ! -f ${FILE} ]] && continue

  EXPANDED=$(dirname ${FILE})/expanded-$(basename ${FILE})
  [[ -d ${EXPANDED} ]] && continue

  mkdir ${EXPANDED}
  inflate ${FILE} ${EXPANDED}
done
